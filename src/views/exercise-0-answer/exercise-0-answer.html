{% extends "views/_base/base.html" %}

{% block navigation %}
<nav class="cc-navigation">
    <a href="/" class="cc-back-link">&#8592; back to overview</a>
    <a href="/exercise-1" class="cc-answer-link">Exercise 1 &#8594;</a>
</nav>
{% endblock %}
{% block introduction %}
{# TODO: add title and description of exercise #}
<h1>Syntax</h1>
<p>The syntax for starting an animation using the Animation Worklet is very similar to WAAPI syntax but has some extra
    parameters</p>
<p>This makes it very easy to start with if you're already familiar with WAAPI. </p>
<p>However, before we can start calling animations, we have to register a the worklet. There are 2 script tags that
    require editing.</p>
<ol>
    <li>The code block with the <code>language="javascript+animationworklet"</code> attribute should register an
        animation using
        <code>registerAnimation()</code></li>
    <li>After the registration it should be loaded by the (already present) call to
        <code>await CSS.animationWorklet.addModule()</code></li>
    <li>Now we can use the animation, intialize it under the WAAPI call, applied to the div with ID <strong>b</strong> (<code>#b</code>)
    </li>
</ol>
<p><strong>If you check the performance tab in your devtools and record for just a second, you can see the extra thread
    created for the worklet</strong></p>

<p>Because we have acces to the timeline in the worklet declaration, we can modify the timeline in between calls</p>
<a href="/sin-timeline"> Here's an example with the same call to the animation, but a remapped timeline on each call in
    the worklet</a>
{% endblock %}

{% block html %}
<section class="cc-html-playground">
    <div class="block" id="a">
        <svg class="cc-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 154.67 153.96">
            <path fill="#0000ff"
                  d="M.9 21.54c-3.5 20.26 3.4 48.96 19.5 77 16.16 28 37.6 48.3 56.9 55.43V0C45 0 16.7 8.4.9 21.54z"></path>
            <path fill="#EDDD3E"
                  d="M134.22 98.53c16.16-28 23.05-56.72 19.56-76.98C137.98 8.4 109.7 0 77.3 0v153.96c19.32-7.16 40.8-27.46 56.9-55.43z"></path>
            <path fill="#FFFFFF"
                  d="M115.57 25.24c-4.52-1.3-9.33-2.33-14.33-3.13-.06 2.2-.17 4.4-.33 6.7-.3 5.1-.9 10.4-1.6 15.6 3.3 1 6.2 2.3 8.5 3.7.1 3.2-.4 6.9-1.4 10.8-1.5 6.2-4.2 12.8-7.9 19-3.6 6.3-7.9 12-12.5 16.4-2.9 2.8-5.8 5.1-8.6 6.6-2.7-1.5-5.7-3.8-8.6-6.6-4.5-4.4-8.9-10-12.5-16.3-3.6-6.3-6.3-12.8-7.9-19-1-3.9-1.4-7.6-1.4-10.8 2.4-1.4 5.3-2.6 8.6-3.7C54.9 39.3 54.3 34 54 29c-.15-2.4-.26-4.6-.32-6.72-5 .8-9.8 1.84-14.3 3.13-7.3 2.1-13.7 4.8-18.8 7.8-.1 6 .8 12.8 2.7 20.2 2.86 11.5 8 23.8 14.8 35.6 6.8 11.8 14.9 22.4 23.4 30.6 5.44 5.3 10.9 9.5 16.1 12.4 5.2-2.9 10.66-7.1 16.13-12.4 8.5-8.2 16.6-18.8 23.4-30.6 6.8-11.8 12-24.1 14.8-35.6 1.9-7.4 2.8-14.2 2.7-20.2-5-3-11.4-5.7-18.7-7.7z"></path>
            <path fill="#EAEAEA"
                  d="M77.33 100.83c-2.78-1.56-5.7-3.8-8.62-6.62-4.5-4.4-8.8-10-12.5-16.3-3.6-6.3-6.3-12.8-7.9-19-1-3.9-1.4-7.6-1.4-10.8 2.4-1.4 5.3-2.6 8.6-3.7-.7-5.2-1.3-10.5-1.6-15.5l-.3-6.7c-5 .8-9.8 1.9-14.3 3.2-7.3 2.1-13.7 4.8-18.8 7.8-.1 6 .8 12.8 2.7 20.2 2.9 11.5 8 23.8 14.8 35.6 6.8 11.8 14.9 22.4 23.4 30.7 5.5 5.3 10.9 9.5 16.1 12.4v-31z"></path>
        </svg>
    </div>
    <div class="block" id="b">
        <svg class="cc-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 154.67 153.96">
            <path fill="#0000ff"
                  d="M.9 21.54c-3.5 20.26 3.4 48.96 19.5 77 16.16 28 37.6 48.3 56.9 55.43V0C45 0 16.7 8.4.9 21.54z"></path>
            <path fill="#EDDD3E"
                  d="M134.22 98.53c16.16-28 23.05-56.72 19.56-76.98C137.98 8.4 109.7 0 77.3 0v153.96c19.32-7.16 40.8-27.46 56.9-55.43z"></path>
            <path fill="#FFFFFF"
                  d="M115.57 25.24c-4.52-1.3-9.33-2.33-14.33-3.13-.06 2.2-.17 4.4-.33 6.7-.3 5.1-.9 10.4-1.6 15.6 3.3 1 6.2 2.3 8.5 3.7.1 3.2-.4 6.9-1.4 10.8-1.5 6.2-4.2 12.8-7.9 19-3.6 6.3-7.9 12-12.5 16.4-2.9 2.8-5.8 5.1-8.6 6.6-2.7-1.5-5.7-3.8-8.6-6.6-4.5-4.4-8.9-10-12.5-16.3-3.6-6.3-6.3-12.8-7.9-19-1-3.9-1.4-7.6-1.4-10.8 2.4-1.4 5.3-2.6 8.6-3.7C54.9 39.3 54.3 34 54 29c-.15-2.4-.26-4.6-.32-6.72-5 .8-9.8 1.84-14.3 3.13-7.3 2.1-13.7 4.8-18.8 7.8-.1 6 .8 12.8 2.7 20.2 2.86 11.5 8 23.8 14.8 35.6 6.8 11.8 14.9 22.4 23.4 30.6 5.44 5.3 10.9 9.5 16.1 12.4 5.2-2.9 10.66-7.1 16.13-12.4 8.5-8.2 16.6-18.8 23.4-30.6 6.8-11.8 12-24.1 14.8-35.6 1.9-7.4 2.8-14.2 2.7-20.2-5-3-11.4-5.7-18.7-7.7z"></path>
            <path fill="#EAEAEA"
                  d="M77.33 100.83c-2.78-1.56-5.7-3.8-8.62-6.62-4.5-4.4-8.8-10-12.5-16.3-3.6-6.3-6.3-12.8-7.9-19-1-3.9-1.4-7.6-1.4-10.8 2.4-1.4 5.3-2.6 8.6-3.7-.7-5.2-1.3-10.5-1.6-15.5l-.3-6.7c-5 .8-9.8 1.9-14.3 3.2-7.3 2.1-13.7 4.8-18.8 7.8-.1 6 .8 12.8 2.7 20.2 2.9 11.5 8 23.8 14.8 35.6 6.8 11.8 14.9 22.4 23.4 30.7 5.5 5.3 10.9 9.5 16.1 12.4v-31z"></path>
        </svg>
    </div>
</section>
{% endblock %}

{% block styles %}
<style type="text/css">
    .block {
        width: 200px;
        height: 200px;
        margin-bottom: 10px;
    }

    code {
        font-family: MyFancyCustomFont, monospace;
        font-size: inherit;
        background: #ffeff0;
        word-wrap: break-word;
        box-decoration-break: clone;
        padding: .1rem .3rem .2rem;
        border-radius: .2rem;
    }
</style>
{% endblock %}
{% block scripts %}
<script language="javascript+animationworklet" type="javascript">
    registerAnimator('move', class {
        animate(currentTime, effect) {
            effect.localTime = currentTime
        }
    });
</script>
<script>
    function urlFromTag(sel) {
        const el = document.querySelector(sel);
        if (!el) {
            throw new Error("Couldn't find element");
        }
        const blob = new Blob([el.textContent], {type: "text/javascript"});
        return URL.createObjectURL(blob);
    }

    async function init() {
        if (!('animationWorklet' in CSS)) {
            console.log("You need AnimationWorklet to see this demo :(")
            return
        }
        await CSS.animationWorklet.addModule(urlFromTag("script[language='javascript+animationworklet']"));
        const effect =  new KeyframeEffect(
            document.querySelector('#a'),
            [
                {
                    transform: 'translateX(0)'
                },
                {
                    transform: 'translateX(500px)'
                }
            ],
            {
                duration: 2000,
                iterations: Number.POSITIVE_INFINITY
            }
        )
        const waapiAnimation = new Animation(effect, document.timeline)
        waapiAnimation.play()

        const workletAnimation = new WorkletAnimation('move', effect, document.timeline)
        workletAnimation.play()

    }

    init();
</script>
{% endblock %}
